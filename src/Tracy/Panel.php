<?php declare(strict_types = 1);

namespace Contributte\Translation\Tracy;

use Contributte\Translation\LocalesResolvers\ResolverInterface;
use Contributte\Translation\Translator;
use ReflectionClass;
use Tracy\IBarPanel;

class Panel implements IBarPanel
{

	private Translator $translator;

	/** @var array<array{id: string, domain: string, count: int}> */
	private array $missingTranslation = [];

	private int $missingTranslationCount = 0;

	/** @var array<\Contributte\Translation\LocalesResolvers\ResolverInterface> */
	private array $localeResolvers = [];

	/** @var array<string, array<string, string>> */
	private array $resources = [];

	private int $resourcesCount = 0;

	/** @var array<string, array<string, string>> */
	private array $ignoredResources = [];

	private int $ignoredResourcesCount = 0;

	public function __construct(
		Translator $translator
	)
	{
		$this->translator = $translator;
		$translator->setTracyPanel($this);
	}

	public function getTab(): string
	{
		// https://postimg.cc/jC4Nq2wg
		$icon = '<svg id="svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="400" height="400" viewBox="0, 0, 400,400"><g id="svgg"><path id="path0" d="M135.043 71.833 C 134.909 72.181,134.800 77.581,134.800 83.833 L 134.800 95.200 94.850 95.200 C 72.877 95.200,54.337 95.313,53.650 95.450 L 52.400 95.700 52.400 108.617 C 52.400 115.722,52.509 121.819,52.643 122.167 C 52.863 122.741,59.258 122.800,121.000 122.800 C 182.742 122.800,189.137 122.859,189.357 123.433 C 189.907 124.865,188.791 132.642,187.180 138.600 C 186.705 140.360,186.228 142.250,186.121 142.800 C 186.014 143.350,185.673 144.367,185.364 145.060 C 185.054 145.754,184.800 146.513,184.800 146.747 C 184.800 146.981,184.545 147.764,184.233 148.486 C 183.922 149.209,183.359 150.520,182.983 151.400 C 179.838 158.762,175.746 165.877,171.251 171.800 C 166.417 178.170,157.084 187.200,155.335 187.200 C 154.210 187.200,145.156 177.835,141.156 172.533 C 140.022 171.030,138.972 169.710,138.824 169.600 C 138.675 169.490,137.394 167.693,135.977 165.607 C 134.560 163.521,133.258 161.631,133.085 161.407 C 131.016 158.734,127.163 152.003,123.121 144.000 L 121.000 139.800 107.600 139.800 L 94.200 139.800 94.071 140.707 C 93.762 142.884,98.144 152.992,102.292 159.671 C 103.342 161.361,104.909 163.881,105.774 165.271 C 111.094 173.815,127.219 193.863,135.900 202.727 C 137.976 204.847,137.988 205.090,136.100 206.598 C 132.783 209.246,122.534 217.055,121.556 217.679 C 120.982 218.045,120.262 218.583,119.956 218.874 C 118.049 220.688,98.622 233.884,92.702 237.387 C 92.080 237.754,88.070 240.248,82.200 243.918 C 81.100 244.605,78.700 246.096,76.866 247.231 C 72.763 249.771,72.450 248.558,80.203 260.174 C 87.659 271.343,86.355 270.731,93.447 266.387 C 94.961 265.459,96.830 264.343,97.600 263.906 C 102.130 261.336,113.821 254.187,113.933 253.919 C 114.007 253.743,114.217 253.600,114.401 253.600 C 115.325 253.600,143.887 234.764,146.395 232.500 C 146.943 232.005,147.504 231.600,147.642 231.600 C 147.779 231.600,148.501 231.063,149.246 230.406 C 149.991 229.750,150.715 229.210,150.856 229.206 C 150.997 229.203,151.984 228.480,153.049 227.600 C 155.561 225.524,155.334 225.468,159.936 229.300 C 166.329 234.623,167.631 235.682,170.592 237.962 C 172.136 239.151,173.490 240.238,173.600 240.376 C 174.420 241.409,195.177 256.000,195.827 256.000 C 195.906 256.000,197.643 257.017,199.686 258.260 C 201.729 259.503,205.110 261.438,207.200 262.560 C 213.168 265.764,212.666 265.298,212.054 267.067 C 211.377 269.023,209.258 274.634,208.604 276.200 C 208.329 276.860,207.610 278.750,207.008 280.400 C 204.155 288.215,202.029 293.743,200.655 296.914 C 200.295 297.746,200.000 298.685,200.000 299.000 C 200.000 299.315,199.745 300.164,199.433 300.886 C 199.122 301.609,198.582 302.857,198.233 303.660 C 197.885 304.464,197.600 305.373,197.600 305.680 C 197.600 305.988,197.448 306.411,197.263 306.620 C 197.078 306.829,196.250 308.890,195.423 311.200 C 194.597 313.510,193.770 315.760,193.586 316.200 C 191.095 322.162,189.729 326.262,190.088 326.700 C 190.399 327.079,193.291 327.200,202.040 327.200 L 213.582 327.200 214.205 326.249 C 214.547 325.726,214.989 324.781,215.187 324.149 C 215.385 323.517,216.086 321.560,216.745 319.800 C 217.405 318.040,218.167 315.970,218.438 315.200 C 218.710 314.430,219.172 313.233,219.466 312.540 C 219.760 311.846,220.000 311.126,220.001 310.940 C 220.001 310.753,220.786 308.530,221.744 306.000 C 222.702 303.470,224.245 299.150,225.173 296.400 C 226.101 293.650,227.116 290.922,227.430 290.338 C 227.743 289.754,228.000 288.910,228.000 288.462 C 228.000 288.014,228.166 287.545,228.369 287.419 C 228.572 287.294,228.859 286.641,229.007 285.968 C 229.155 285.296,229.527 284.263,229.835 283.673 C 230.143 283.083,230.396 282.373,230.398 282.095 C 230.399 281.817,230.566 281.277,230.768 280.895 C 230.970 280.513,231.544 279.030,232.043 277.600 C 232.541 276.170,233.141 274.868,233.375 274.706 C 234.225 274.119,302.256 274.344,302.747 274.936 C 302.991 275.231,303.637 276.806,304.181 278.436 C 304.726 280.066,305.999 283.740,307.010 286.600 C 308.022 289.460,309.089 292.520,309.383 293.400 C 309.677 294.280,310.765 297.340,311.802 300.200 C 312.839 303.060,313.831 305.940,314.006 306.600 C 314.182 307.260,315.169 310.140,316.201 313.000 C 317.232 315.860,318.609 319.820,319.261 321.800 C 319.913 323.780,320.710 325.805,321.033 326.300 L 321.618 327.200 333.929 327.200 C 342.200 327.200,346.382 327.058,346.671 326.769 C 347.221 326.219,346.948 325.333,342.839 314.324 C 341.057 309.552,339.600 305.463,339.600 305.237 C 339.600 305.012,339.345 304.236,339.033 303.514 C 338.722 302.791,338.182 301.543,337.833 300.740 C 337.485 299.936,337.200 299.087,337.200 298.853 C 337.200 298.619,336.940 297.836,336.622 297.114 C 336.305 296.391,335.506 294.270,334.848 292.400 C 333.288 287.970,328.068 273.688,327.539 272.402 C 327.313 271.854,326.713 270.144,326.205 268.602 C 325.697 267.061,324.168 262.830,322.806 259.200 C 321.445 255.570,319.908 251.340,319.392 249.800 C 318.875 248.260,318.067 246.010,317.596 244.800 C 317.125 243.590,316.587 242.150,316.400 241.600 C 316.213 241.050,315.671 239.610,315.195 238.400 C 314.720 237.190,314.187 235.660,314.012 235.000 C 313.639 233.595,311.720 228.160,311.188 227.000 C 310.986 226.560,310.443 225.120,309.982 223.800 C 309.520 222.480,309.000 221.040,308.825 220.600 C 308.110 218.802,306.817 215.290,306.248 213.600 C 305.914 212.610,305.257 210.810,304.787 209.600 C 304.317 208.390,303.843 207.040,303.733 206.600 C 303.623 206.160,303.380 205.440,303.192 205.000 C 301.515 201.062,301.200 200.213,301.200 199.629 C 301.200 199.261,301.037 198.789,300.837 198.580 C 300.638 198.371,300.292 197.570,300.069 196.800 C 299.564 195.053,298.830 192.981,298.134 191.340 C 297.840 190.646,297.600 189.802,297.600 189.463 C 297.600 189.124,297.434 188.745,297.231 188.619 C 297.028 188.494,296.735 187.814,296.580 187.109 C 296.425 186.403,296.156 185.550,295.981 185.213 C 295.807 184.876,295.272 183.430,294.793 182.000 C 294.314 180.570,293.770 179.040,293.585 178.600 C 293.400 178.160,292.141 174.740,290.787 171.000 C 289.433 167.260,288.094 163.660,287.811 163.000 C 287.527 162.340,286.988 160.810,286.613 159.600 C 286.237 158.390,285.675 156.833,285.365 156.140 C 285.054 155.446,284.800 154.702,284.800 154.485 C 284.800 154.269,284.531 153.576,284.202 152.946 C 283.874 152.316,283.604 151.504,283.602 151.143 C 283.601 150.781,283.315 150.376,282.967 150.243 C 281.638 149.733,256.519 149.973,256.106 150.500 C 255.891 150.775,255.225 152.350,254.628 154.000 C 254.030 155.650,253.284 157.675,252.970 158.500 C 252.657 159.325,252.130 160.720,251.800 161.600 C 251.470 162.480,250.930 163.920,250.600 164.800 C 248.899 169.336,248.536 170.257,247.226 173.351 C 246.772 174.424,246.400 175.551,246.400 175.856 C 246.400 176.161,246.221 176.723,246.003 177.105 C 245.784 177.487,244.241 181.490,242.573 186.000 C 240.906 190.510,239.285 194.875,238.971 195.700 C 237.622 199.243,237.059 200.675,236.546 201.860 C 236.246 202.554,236.000 203.373,236.000 203.680 C 236.000 203.988,235.848 204.411,235.662 204.620 C 235.476 204.829,234.916 206.170,234.417 207.600 C 233.917 209.030,233.259 210.767,232.954 211.460 C 232.650 212.154,232.400 212.913,232.400 213.147 C 232.400 213.381,232.145 214.164,231.833 214.886 C 230.682 217.556,230.084 219.048,229.385 221.000 C 228.990 222.100,228.518 223.171,228.334 223.380 C 228.150 223.589,228.000 224.012,228.000 224.320 C 228.000 224.627,227.753 225.446,227.450 226.140 C 227.148 226.833,226.316 229.020,225.600 231.000 C 222.137 240.589,222.474 240.238,218.674 238.196 C 214.517 235.962,201.937 227.763,200.245 226.186 C 200.000 225.958,199.080 225.241,198.200 224.594 C 190.027 218.581,176.077 205.696,176.654 204.692 C 176.844 204.360,177.990 203.018,179.200 201.710 C 183.457 197.107,184.267 196.158,187.981 191.410 C 190.042 188.776,193.132 184.456,194.848 181.810 C 196.565 179.165,198.111 176.815,198.285 176.590 C 201.050 172.992,209.323 154.640,211.984 146.200 C 212.678 144.000,213.415 141.787,213.623 141.281 C 213.830 140.776,214.000 139.900,214.000 139.335 C 214.000 138.770,214.261 137.473,214.581 136.454 C 215.607 133.179,216.400 129.647,216.400 128.352 C 216.400 126.924,217.150 124.050,217.719 123.300 C 218.008 122.918,221.154 122.800,231.035 122.800 C 243.416 122.800,243.990 122.767,244.386 122.026 C 245.027 120.829,244.946 96.142,244.300 95.724 C 244.025 95.546,226.340 95.310,205.000 95.200 L 166.200 95.000 165.985 83.200 C 165.866 76.710,165.731 71.355,165.685 71.300 C 165.228 70.761,135.254 71.282,135.043 71.833 M270.441 181.600 C 271.102 183.470,272.342 187.070,273.196 189.600 C 274.049 192.130,275.581 196.540,276.598 199.400 C 277.616 202.260,279.233 206.940,280.190 209.800 C 281.148 212.660,282.500 216.530,283.195 218.400 C 283.889 220.270,284.644 222.430,284.871 223.200 C 285.099 223.970,285.400 224.780,285.540 225.000 C 285.680 225.220,285.998 226.120,286.246 227.000 C 286.647 228.418,288.762 234.495,290.633 239.600 C 293.908 248.539,295.603 254.152,295.120 254.459 C 294.834 254.642,282.542 254.748,267.805 254.695 C 238.246 254.590,239.925 254.744,241.130 252.247 C 241.503 251.474,244.638 242.890,247.649 234.400 C 249.021 230.530,249.835 228.376,250.640 226.486 C 250.948 225.764,251.200 224.855,251.200 224.466 C 251.200 224.078,251.367 223.589,251.572 223.380 C 251.930 223.015,253.022 220.261,253.468 218.600 C 253.744 217.573,255.975 211.249,256.431 210.200 C 256.623 209.760,257.157 208.320,257.618 207.000 C 258.080 205.680,258.611 204.240,258.800 203.800 C 258.988 203.360,259.521 201.830,259.983 200.400 C 260.825 197.795,260.973 197.402,262.091 194.798 C 262.422 194.028,262.821 192.815,262.977 192.103 C 263.134 191.391,263.428 190.706,263.631 190.581 C 263.834 190.455,264.000 189.949,264.000 189.456 C 264.000 188.963,264.163 188.389,264.363 188.180 C 264.562 187.971,264.908 187.170,265.131 186.400 C 265.636 184.653,266.370 182.581,267.066 180.940 C 267.360 180.246,267.600 179.421,267.600 179.106 C 267.600 178.791,267.726 178.407,267.880 178.253 C 268.608 177.525,269.335 178.475,270.441 181.600 " stroke="none" fill="#f9fafb" fill-rule="evenodd"></path><path id="path1" d="M14.100 14.192 L 12.400 15.944 12.400 200.004 L 12.400 384.063 14.168 385.832 L 15.937 387.600 200.000 387.600 L 384.063 387.600 385.832 385.832 L 387.600 384.063 387.600 200.000 L 387.600 15.937 385.832 14.168 L 384.063 12.400 199.932 12.420 L 15.800 12.441 14.100 14.192 M165.685 71.300 C 165.731 71.355,165.866 76.710,165.985 83.200 L 166.200 95.000 205.000 95.200 C 226.340 95.310,244.025 95.546,244.300 95.724 C 244.946 96.142,245.027 120.829,244.386 122.026 C 243.990 122.767,243.416 122.800,231.035 122.800 C 221.154 122.800,218.008 122.918,217.719 123.300 C 217.150 124.050,216.400 126.924,216.400 128.352 C 216.400 129.647,215.607 133.179,214.581 136.454 C 214.261 137.473,214.000 138.770,214.000 139.335 C 214.000 139.900,213.830 140.776,213.623 141.281 C 213.415 141.787,212.678 144.000,211.984 146.200 C 209.323 154.640,201.050 172.992,198.285 176.590 C 198.111 176.815,196.565 179.165,194.848 181.810 C 193.132 184.456,190.042 188.776,187.981 191.410 C 184.267 196.158,183.457 197.107,179.200 201.710 C 177.990 203.018,176.844 204.360,176.654 204.692 C 176.077 205.696,190.027 218.581,198.200 224.594 C 199.080 225.241,200.000 225.958,200.245 226.186 C 201.937 227.763,214.517 235.962,218.674 238.196 C 222.474 240.238,222.137 240.589,225.600 231.000 C 226.316 229.020,227.148 226.833,227.450 226.140 C 227.753 225.446,228.000 224.627,228.000 224.320 C 228.000 224.012,228.150 223.589,228.334 223.380 C 228.518 223.171,228.990 222.100,229.385 221.000 C 230.084 219.048,230.682 217.556,231.833 214.886 C 232.145 214.164,232.400 213.381,232.400 213.147 C 232.400 212.913,232.650 212.154,232.954 211.460 C 233.259 210.767,233.917 209.030,234.417 207.600 C 234.916 206.170,235.476 204.829,235.662 204.620 C 235.848 204.411,236.000 203.988,236.000 203.680 C 236.000 203.373,236.246 202.554,236.546 201.860 C 237.059 200.675,237.622 199.243,238.971 195.700 C 239.285 194.875,240.906 190.510,242.573 186.000 C 244.241 181.490,245.784 177.487,246.003 177.105 C 246.221 176.723,246.400 176.161,246.400 175.856 C 246.400 175.551,246.772 174.424,247.226 173.351 C 248.536 170.257,248.899 169.336,250.600 164.800 C 250.930 163.920,251.470 162.480,251.800 161.600 C 252.130 160.720,252.657 159.325,252.970 158.500 C 253.284 157.675,254.030 155.650,254.628 154.000 C 255.225 152.350,255.891 150.775,256.106 150.500 C 256.519 149.973,281.638 149.733,282.967 150.243 C 283.315 150.376,283.601 150.781,283.602 151.143 C 283.604 151.504,283.874 152.316,284.202 152.946 C 284.531 153.576,284.800 154.269,284.800 154.485 C 284.800 154.702,285.054 155.446,285.365 156.140 C 285.675 156.833,286.237 158.390,286.613 159.600 C 286.988 160.810,287.527 162.340,287.811 163.000 C 288.094 163.660,289.433 167.260,290.787 171.000 C 292.141 174.740,293.400 178.160,293.585 178.600 C 293.770 179.040,294.314 180.570,294.793 182.000 C 295.272 183.430,295.807 184.876,295.981 185.213 C 296.156 185.550,296.425 186.403,296.580 187.109 C 296.735 187.814,297.028 188.494,297.231 188.619 C 297.434 188.745,297.600 189.124,297.600 189.463 C 297.600 189.802,297.840 190.646,298.134 191.340 C 298.830 192.981,299.564 195.053,300.069 196.800 C 300.292 197.570,300.638 198.371,300.837 198.580 C 301.037 198.789,301.200 199.261,301.200 199.629 C 301.200 200.213,301.515 201.062,303.192 205.000 C 303.380 205.440,303.623 206.160,303.733 206.600 C 303.843 207.040,304.317 208.390,304.787 209.600 C 305.257 210.810,305.914 212.610,306.248 213.600 C 306.817 215.290,308.110 218.802,308.825 220.600 C 309.000 221.040,309.520 222.480,309.982 223.800 C 310.443 225.120,310.986 226.560,311.188 227.000 C 311.720 228.160,313.639 233.595,314.012 235.000 C 314.187 235.660,314.720 237.190,315.195 238.400 C 315.671 239.610,316.213 241.050,316.400 241.600 C 316.587 242.150,317.125 243.590,317.596 244.800 C 318.067 246.010,318.875 248.260,319.392 249.800 C 319.908 251.340,321.445 255.570,322.806 259.200 C 324.168 262.830,325.697 267.061,326.205 268.602 C 326.713 270.144,327.313 271.854,327.539 272.402 C 328.068 273.688,333.288 287.970,334.848 292.400 C 335.506 294.270,336.305 296.391,336.622 297.114 C 336.940 297.836,337.200 298.619,337.200 298.853 C 337.200 299.087,337.485 299.936,337.833 300.740 C 338.182 301.543,338.722 302.791,339.033 303.514 C 339.345 304.236,339.600 305.012,339.600 305.237 C 339.600 305.463,341.057 309.552,342.839 314.324 C 346.948 325.333,347.221 326.219,346.671 326.769 C 346.382 327.058,342.200 327.200,333.929 327.200 L 321.618 327.200 321.033 326.300 C 320.710 325.805,319.913 323.780,319.261 321.800 C 318.609 319.820,317.232 315.860,316.201 313.000 C 315.169 310.140,314.182 307.260,314.006 306.600 C 313.831 305.940,312.839 303.060,311.802 300.200 C 310.765 297.340,309.677 294.280,309.383 293.400 C 309.089 292.520,308.022 289.460,307.010 286.600 C 305.999 283.740,304.726 280.066,304.181 278.436 C 303.637 276.806,302.991 275.231,302.747 274.936 C 302.256 274.344,234.225 274.119,233.375 274.706 C 233.141 274.868,232.541 276.170,232.043 277.600 C 231.544 279.030,230.970 280.513,230.768 280.895 C 230.566 281.277,230.399 281.817,230.398 282.095 C 230.396 282.373,230.143 283.083,229.835 283.673 C 229.527 284.263,229.155 285.296,229.007 285.968 C 228.859 286.641,228.572 287.294,228.369 287.419 C 228.166 287.545,228.000 288.014,228.000 288.462 C 228.000 288.910,227.743 289.754,227.430 290.338 C 227.116 290.922,226.101 293.650,225.173 296.400 C 224.245 299.150,222.702 303.470,221.744 306.000 C 220.786 308.530,220.001 310.753,220.001 310.940 C 220.000 311.126,219.760 311.846,219.466 312.540 C 219.172 313.233,218.710 314.430,218.438 315.200 C 218.167 315.970,217.405 318.040,216.745 319.800 C 216.086 321.560,215.385 323.517,215.187 324.149 C 214.989 324.781,214.547 325.726,214.205 326.249 L 213.582 327.200 202.040 327.200 C 193.291 327.200,190.399 327.079,190.088 326.700 C 189.729 326.262,191.095 322.162,193.586 316.200 C 193.770 315.760,194.597 313.510,195.423 311.200 C 196.250 308.890,197.078 306.829,197.263 306.620 C 197.448 306.411,197.600 305.988,197.600 305.680 C 197.600 305.373,197.885 304.464,198.233 303.660 C 198.582 302.857,199.122 301.609,199.433 300.886 C 199.745 300.164,200.000 299.315,200.000 299.000 C 200.000 298.685,200.295 297.746,200.655 296.914 C 202.029 293.743,204.155 288.215,207.008 280.400 C 207.610 278.750,208.329 276.860,208.604 276.200 C 209.258 274.634,211.377 269.023,212.054 267.067 C 212.666 265.298,213.168 265.764,207.200 262.560 C 205.110 261.438,201.729 259.503,199.686 258.260 C 197.643 257.017,195.906 256.000,195.827 256.000 C 195.177 256.000,174.420 241.409,173.600 240.376 C 173.490 240.238,172.136 239.151,170.592 237.962 C 167.631 235.682,166.329 234.623,159.936 229.300 C 155.334 225.468,155.561 225.524,153.049 227.600 C 151.984 228.480,150.997 229.203,150.856 229.206 C 150.715 229.210,149.991 229.750,149.246 230.406 C 148.501 231.063,147.779 231.600,147.642 231.600 C 147.504 231.600,146.943 232.005,146.395 232.500 C 143.887 234.764,115.325 253.600,114.401 253.600 C 114.217 253.600,114.007 253.743,113.933 253.919 C 113.821 254.187,102.130 261.336,97.600 263.906 C 96.830 264.343,94.961 265.459,93.447 266.387 C 86.355 270.731,87.659 271.343,80.203 260.174 C 72.450 248.558,72.763 249.771,76.866 247.231 C 78.700 246.096,81.100 244.605,82.200 243.918 C 88.070 240.248,92.080 237.754,92.702 237.387 C 98.622 233.884,118.049 220.688,119.956 218.874 C 120.262 218.583,120.982 218.045,121.556 217.679 C 122.534 217.055,132.783 209.246,136.100 206.598 C 137.988 205.090,137.976 204.847,135.900 202.727 C 127.219 193.863,111.094 173.815,105.774 165.271 C 104.909 163.881,103.342 161.361,102.292 159.671 C 98.144 152.992,93.762 142.884,94.071 140.707 L 94.200 139.800 107.600 139.800 L 121.000 139.800 123.121 144.000 C 127.163 152.003,131.016 158.734,133.085 161.407 C 133.258 161.631,134.560 163.521,135.977 165.607 C 137.394 167.693,138.675 169.490,138.824 169.600 C 138.972 169.710,140.022 171.030,141.156 172.533 C 145.156 177.835,154.210 187.200,155.335 187.200 C 157.084 187.200,166.417 178.170,171.251 171.800 C 175.746 165.877,179.838 158.762,182.983 151.400 C 183.359 150.520,183.922 149.209,184.233 148.486 C 184.545 147.764,184.800 146.981,184.800 146.747 C 184.800 146.513,185.054 145.754,185.364 145.060 C 185.673 144.367,186.014 143.350,186.121 142.800 C 186.228 142.250,186.705 140.360,187.180 138.600 C 188.791 132.642,189.907 124.865,189.357 123.433 C 189.137 122.859,182.742 122.800,121.000 122.800 C 59.258 122.800,52.863 122.741,52.643 122.167 C 52.509 121.819,52.400 115.722,52.400 108.617 L 52.400 95.700 53.650 95.450 C 54.337 95.313,72.877 95.200,94.850 95.200 L 134.800 95.200 134.800 83.833 C 134.800 77.581,134.909 72.181,135.043 71.833 C 135.254 71.282,165.228 70.761,165.685 71.300 M267.880 178.253 C 267.726 178.407,267.600 178.791,267.600 179.106 C 267.600 179.421,267.360 180.246,267.066 180.940 C 266.370 182.581,265.636 184.653,265.131 186.400 C 264.908 187.170,264.562 187.971,264.363 188.180 C 264.163 188.389,264.000 188.963,264.000 189.456 C 264.000 189.949,263.834 190.455,263.631 190.581 C 263.428 190.706,263.134 191.391,262.977 192.103 C 262.821 192.815,262.422 194.028,262.091 194.798 C 260.973 197.402,260.825 197.795,259.983 200.400 C 259.521 201.830,258.988 203.360,258.800 203.800 C 258.611 204.240,258.080 205.680,257.618 207.000 C 257.157 208.320,256.623 209.760,256.431 210.200 C 255.975 211.249,253.744 217.573,253.468 218.600 C 253.022 220.261,251.930 223.015,251.572 223.380 C 251.367 223.589,251.200 224.078,251.200 224.466 C 251.200 224.855,250.948 225.764,250.640 226.486 C 249.835 228.376,249.021 230.530,247.649 234.400 C 244.638 242.890,241.503 251.474,241.130 252.247 C 239.925 254.744,238.246 254.590,267.805 254.695 C 282.542 254.748,294.834 254.642,295.120 254.459 C 295.603 254.152,293.908 248.539,290.633 239.600 C 288.762 234.495,286.647 228.418,286.246 227.000 C 285.998 226.120,285.680 225.220,285.540 225.000 C 285.400 224.780,285.099 223.970,284.871 223.200 C 284.644 222.430,283.889 220.270,283.195 218.400 C 282.500 216.530,281.148 212.660,280.190 209.800 C 279.233 206.940,277.616 202.260,276.598 199.400 C 275.581 196.540,274.049 192.130,273.196 189.600 C 269.363 178.242,268.894 177.240,267.880 178.253 " stroke="none" fill="#3464ac" fill-rule="evenodd"></path></g></svg>';
		$errMsg = ($this->missingTranslationCount > 1) ? 'errors' : 'error';
		return '<span title="Contributte/Translation">' .
			$icon .
			'&nbsp;<strong>' .
			$this->translator->getLocale() .
			'</strong>' .
			($this->missingTranslationCount > 0 ? ' (' . $this->missingTranslationCount . ' ' . $errMsg . ')' : '') .
			'</span>';
	}

	public function getPanel(): string
	{
		$panel = [];

		$panel[] = '<h1>Missing translations: ' . $this->missingTranslationCount . ', Loaded resources: ' . $this->resourcesCount . '</h1>';
		$panel[] = '<div class="tracy-inner">';

		$panel[] = '<div class="tracy-inner-container"><h2>Translator settings</h2>';
		$panel[] = '<table class="tracy-sortable"><colgroup><col style="width: 75%"><col style="width: 25%"></colgroup>';
		$panel[] = '<tr><th>Name</th><th>Value</th></tr>';
		$panel[] = '<tr><td>Default locale</td><td class="contributte-translation-default-locale">' . htmlspecialchars($this->translator->getDefaultLocale()) . '</td></tr>';
		$panel[] = '<tr><td>Locales whitelist</td><td class="contributte-translation-locales-whitelist">' . ($this->translator->getLocalesWhitelist() !== null ? htmlspecialchars(implode(', ', $this->translator->getLocalesWhitelist())) : '&nbsp;') . '</td></tr>';
		$panel[] = '</table></div>';

		// missing translations
		if ($this->missingTranslationCount > 0) {
			$panel[] = '<br>';
			$panel[] = '<div class="tracy-inner-container"><h2>Missing translations: ' . $this->missingTranslationCount . '</h2>';

			$panel[] = '<table class="tracy-sortable"><colgroup><col style="width: 50%"><col style="width: 25%"><col style="width: 25%"></colgroup>';
			$panel[] = '<tr><th>ID</th><th>Domain</th><th>Count</th></tr>';

			foreach ($this->missingTranslation as $v1) {
				$panel[] = '<tr class="contributte-translation-missing-translation"><td>' . htmlspecialchars($v1['id']) . '</td><td>' . htmlspecialchars($v1['domain']) . '</td><td>' . $v1['count'] . '</td></tr>';
			}

			$panel[] = '</table></div>';
		}

		// locale resolvers
		if (count($this->localeResolvers) > 0) {
			$panel[] = '<br>';
			$panel[] = '<div class="tracy-inner-container"><h2>Locale resolvers</h2>';
			$panel[] = '<table class="tracy-sortable"><colgroup><col style="width: 5%"><col style="width: 70%"><col style="width: 25%"></colgroup>';
			$panel[] = '<tr><th>#</th><th>Resolver</th><th>Locale</th></tr>';

			$counter = 1;
			foreach ($this->localeResolvers as $v1) {
				$reflection = new ReflectionClass($v1);
				$locale = $v1->resolve($this->translator);

				$panel[] = '<tr class="contributte-translation-locale-resolvers"><td>' . $counter++ . '.</td><td title="' . $reflection->getName() . '">' . $reflection->getShortName() . '</td><td>' . ($locale !== null ? htmlspecialchars($locale) : '<i>n/a</i>') . '</td></tr>';
			}

			$panel[] = '</table></div>';
		}

		// resources
		if (count($this->resources) > 0) {
			ksort($this->resources);

			$panel[] = '<br>';
			$panel[] = '<div class="tracy-inner-container"><h2>Loaded resources: ' . $this->resourcesCount . '</h2>';
			$panel[] = self::createResourcePanelHelper($this->resources, 'contributte-translation-resources');
			$panel[] = '</div>';
		}

		// ignored resources
		if (count($this->ignoredResources) > 0) {
			ksort($this->ignoredResources);

			$panel[] = '<br>';
			$panel[] = '<h2>Ignored resources: ' . $this->ignoredResourcesCount . ($this->translator->getLocalesWhitelist() !== null ? ', <small>whitelist: ' . implode(', ', array_map('htmlspecialchars', $this->translator->getLocalesWhitelist())) . '</small>' : null) . '</h2>';
			$panel[] = self::createResourcePanelHelper($this->ignoredResources, 'contributte-translation-ignored-resources');
		}

		$panel[] = '</div>';

		return implode('', $panel);
	}

	/**
	 * @param array<array<string>> $resources
	 */
	private static function createResourcePanelHelper(
		array $resources,
		string $class
	): string
	{
		$string = '<table class="tracy-sortable"><colgroup><col style="width: 10%"><col style="width: 10%"><col style="width: 80%"></colgroup>';
		$string .= '<tr><th>Locale</th><th>Domain</th><th>File name</th></tr>';

		foreach ($resources as $k1 => $v1) {
			foreach ($v1 as $k2 => $v2) {
				$string .= '<tr class="' . $class . '">';
				$string .= '<td>' . htmlspecialchars($k1) . '</td>';
				$string .= '<td>' . htmlspecialchars($v2) . '</td>';
				$string .= '<td>' . htmlspecialchars(dirname($k2)) . '/<strong>' . htmlspecialchars(basename($k2)) . '</strong></td>';
				$string .= '</tr>';
			}
		}

		return $string . '</table>';
	}

	public function addMissingTranslation(
		string $id,
		string $domain
	): self
	{
		$key = $domain . '.' . $id;

		if (!array_key_exists($key, $this->missingTranslation)) {
			$this->missingTranslation[$key] = [
				'id' => $id,
				'domain' => $domain,
				'count' => 0,
			];

			$this->missingTranslationCount++;
		}

		$this->missingTranslation[$key]['count']++;

		return $this;
	}

	public function addLocaleResolver(
		ResolverInterface $resolver
	): self
	{
		$this->localeResolvers[] = $resolver;

		return $this;
	}

	public function addResource(
		string $resource,
		string $locale,
		string $domain
	): self
	{
		$this->resources[$locale][$resource] = $domain;
		$this->resourcesCount++;

		return $this;
	}

	/**
	 * @return array<array<string>>
	 * @internal
	 */
	public function getResources(): array
	{
		return $this->resources;
	}

	public function addIgnoredResource(
		string $resource,
		string $locale,
		string $domain
	): self
	{
		$this->ignoredResources[$locale][$resource] = $domain;
		$this->ignoredResourcesCount++;

		return $this;
	}

	/**
	 * @return array<string, array<string, string>>
	 * @internal
	 */
	public function getIgnoredResources(): array
	{
		return $this->ignoredResources;
	}

}
